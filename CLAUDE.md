# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

MCP (Model Context Protocol) server built with the **mcp-use** framework. Serves tools and React-based widgets that render rich UI in MCP clients (e.g., ChatGPT). Currently implements a fruit shop demo with search and detail tools.

## Commands

```bash
npm run dev       # Start dev server with HMR at http://localhost:3000
npm run build     # Production build via mcp-use
npm run start     # Start production server
npm run deploy    # Deploy to Manufact Cloud
```

Dev server endpoints:
- `http://localhost:3000/mcp` — MCP protocol endpoint
- `http://localhost:3000/inspector` — Interactive tool/widget testing UI

## Architecture

### Server Entry (`index.ts`)

Defines the MCP server instance and registers tools via `server.tool()`. Each tool handler returns responses using helpers: `widget()` (render a React widget with props), `text()` (plain text), or `object()` (structured data).

### Widgets (`resources/<widget-name>/`)

Each widget is a self-contained directory:
- `widget.tsx` — Main React component, exports `widgetMetadata` and default component
- `types.ts` — Zod prop schema (`propSchema`) used for type safety and validation
- `components/` — Sub-components
- `hooks/` — Custom hooks

Widgets receive props from tool calls via `useWidget<Props, State>()` hook, which also provides `state`/`setState` for persistence, `displayMode`, `sendFollowUpMessage`, and `useCallTool` for invoking other tools from the widget.

### Generated Files (`.mcp-use/`)

Auto-generated by the framework — do not edit manually. Contains widget entry points and `tool-registry.d.ts` with typed tool definitions. Regenerated on `postinstall` and during dev.

### Static Assets (`public/`)

Served at the server root. Images referenced in widgets use the `Image` component from `mcp-use/react`.

## Key Patterns

- **Tool naming**: kebab-case (`search-tools`, `get-fruit-details`)
- **Widget metadata**: Each widget exports `widgetMetadata` with a Zod `props` schema, description, and CSP config for allowed domains
- **Tool-widget binding**: Tools specify `widget: { name, invoking, invoked }` to attach a widget to their response
- **Styling**: Tailwind CSS v4 with `@source` directives in `resources/styles.css`; dark mode supported via `@variant dark`
- **State**: Widget-level state persistence through `useWidget` hook's `setState`; no global state management
- **Providers**: Widgets wrap in `AppsSDKUIProvider` and `McpUseProvider`

## Development Workflow

Always run `/tmux-dev status` first to check if the dev server is already running before starting a new one — do not create duplicate sessions. Use `/tmux-dev start` only if no session exists. When debugging issues, use `/tmux-dev logs` to inspect server output for errors, compilation failures, and request traces rather than restarting the server or guessing at the problem.

## Stack

mcp-use, React 19, TypeScript (strict), Vite, Tailwind CSS v4, Zod v4, @openai/apps-sdk-ui
